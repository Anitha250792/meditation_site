{% extends "main/base.html" %}
{% load static %}

{% block title %}Sign Up - DEE PLUS{% endblock %}

{% block extra_css %}
<style>
.form-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  max-width: 1000px;
  margin: auto;
  margin-top: 100px;
  margin-bottom: 50px;
  background: #f8f9fa;
  border-radius: 15px;
  overflow: hidden;
}

.image-section img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.form-section {
  padding: 40px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.password-wrapper { position: relative; }
.toggle-password { position: absolute; top: 50%; right: 10px; transform: translateY(-50%); cursor: pointer; }

@media(max-width:768px){
  .form-container { grid-template-columns: 1fr; }
  .image-section { display: none; }
}
</style>
{% endblock %}

{% block content %}
<div class="container form-container">
  <!-- Image Section -->
  <div class="image-section">
    <img src="{% static 'images/clinic.jpg' %}" alt="Sign Up Image">
  </div>

  <!-- Form Section -->
  <div class="form-section">
    <h2>Sign Up</h2>
    <form id="signupForm">
      <div class="mb-3">
        <label>Name</label>
        <input type="text" class="form-control" id="name" required>
      </div>
      <div class="mb-3">
        <label>Email</label>
        <input type="email" class="form-control" id="email" required>
      </div>
      <div class="mb-3">
        <label>Password</label>
        <div class="password-wrapper">
          <input type="password" class="form-control" id="password" required>
          <span class="toggle-password" id="togglePwd">&#128065;</span>
        </div>
      </div>
      <div class="mb-3">
        <label>Gender</label>
        <div class="d-flex gap-3">
          <label><input type="radio" name="gender" value="Male" required> Male</label>
          <label><input type="radio" name="gender" value="Female" required> Female</label>
          <label><input type="radio" name="gender" value="Other" required> Other</label>
        </div>
      </div>
      <div class="mb-3">
        <label>Goal</label>
        <input type="text" class="form-control" id="goal" required>
      </div>

      <button type="submit" class="btn btn-primary w-100">Sign Up</button>
      <p class="mt-3">Already have an account? <a href="{% url 'signin' %}">Sign In</a></p>
      <p id="message" class="text-success"></p>
    </form>
  </div>
</div>

<script>
document.getElementById('signupForm').addEventListener('submit', function (e) {
  e.preventDefault();

  // Collect values
  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim().toLowerCase();
  const password = document.getElementById('password').value;
  const genderRadios = document.querySelectorAll('input[name="gender"]');
  const goal = document.getElementById('goal').value.trim();
  const message = document.getElementById('message');

  // Reset message
  message.textContent = "";
  message.style.color = "red";

  // Gender selection
  let gender = '';
  genderRadios.forEach(radio => { if (radio.checked) gender = radio.value; });

  // === VALIDATION ===
  if (!name || !email || !password || !gender || !goal) {
    message.textContent = '⚠️ Please fill all fields.';
    return;
  }

  // Email validation
  const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailPattern.test(email)) {
    message.textContent = '⚠️ Please enter a valid email.';
    return;
  }

  // Password strength validation
  const passwordPattern = /^(?=.*[0-9])(?=.*[!@#$%^&*]).{6,}$/;
  if (!passwordPattern.test(password)) {
    message.textContent = '⚠️ Password must be at least 6 characters and include 1 number & 1 special character.';
    return;
  }

  // Check if user exists
  if (localStorage.getItem(email)) {
    message.textContent = '⚠️ User already exists with this email.';
    return;
  }

  // Save user data (for demo: localStorage)
  const userData = { name, email, password, gender, goal };
  localStorage.setItem(email, JSON.stringify(userData));

  // Success message
  message.textContent = '✅ Signup successful! Redirecting to Sign In...';
  message.style.color = 'green';

  // Redirect after delay
  setTimeout(() => {
    window.location.href = "{% url 'signin' %}";
  }, 2000);

  // Clear form
  this.reset();
});

// === Password toggle ===
document.getElementById("togglePwd").addEventListener("click", function () {
  const pwd = document.getElementById("password");
  pwd.type = pwd.type === "password" ? "text" : "password";
  this.style.color = pwd.type === "text" ? "#2f80ed" : "#666";
});

// === Mobile nav toggle ===
const menuToggle = document.getElementById("menu-toggle");
if (menuToggle) {
  menuToggle.addEventListener("click", function () {
    document.getElementById("nav-menu").classList.toggle("active");
  });
}

</script>
{% endblock %}
