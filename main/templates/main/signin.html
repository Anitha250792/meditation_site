{% extends "main/base.html" %}
{% load static %}

{% block title %}Sign In - DEE PLUS{% endblock %}

{% block extra_css %}
<style>
/* Add your signin page-specific CSS */
.form-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  max-width: 1000px;
  margin: auto;
  margin-top: 100px;
  margin-bottom: 50px;
}

.form-section {
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: 40px;
  background: transparent;
}

.form-section h1 {
  margin-bottom: 20px;
}

.google-btn {
  background: white;
  border: 1px solid #ddd;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  border-radius: 10px;
  cursor: pointer;
}

.divider {
  text-align: center;
  margin: 20px 0;
  position: relative;
}

.divider span {
  padding: 0 10px;
  position: relative;
  z-index: 1;
  color: #333;
}

.password-wrapper {
  position: relative;
}

.toggle-password {
  position: absolute;
  top: 50%;
  right: 10px;
  transform: translateY(-50%);
  cursor: pointer;
}

.image-section img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

@media(max-width:768px){
  .form-container { grid-template-columns: 1fr; }
  .image-section { display: none; }
}
</style>
{% endblock %}

{% block content %}
<div class="container form-container">
  <!-- Form Section -->
  <div class="form-section">
    <h1>Welcome Back</h1>
    <button class="google-btn">
      <img src="https://img.icons8.com/color/48/000000/google-logo.png" alt="google"> Sign in with Google
    </button>
    <div class="divider"><span>OR</span></div>

    <form id="signin-form">
      <div class="mb-3">
        <label>Email address</label>
        <input type="email" class="form-control" id="email" required>
      </div>

      <div class="mb-3">
        <label>Password</label>
        <div class="password-wrapper">
          <input type="password" class="form-control" id="password" required>
          <span class="toggle-password" id="togglePwd">&#128065;</span>
        </div>
      </div>

      <div class="d-flex justify-content-between mb-3">
        <label><input type="checkbox"> Remember me</label>
        <a href="#">Forgot Password?</a>
      </div>

      <p class="text-danger" id="error-msg"></p>
      
      <!-- ✅ Proper button -->
      <button type="submit" class="btn btn-primary w-100">Sign In</button>

      <p class="mt-3">Don’t have an account? <a href="{% url 'signup' %}">Sign Up</a></p>
    </form>
  </div>

  <!-- Image Section -->
  <div class="image-section">
    <img src="{% static 'images/online.jpg' %}" alt="Sign In Image">
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const signinForm = document.getElementById("signin-form");
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const errorMsg = document.getElementById("error-msg");
  const togglePwd = document.getElementById("togglePwd");

  // 🔹 Handle Sign-in
  signinForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const email = emailInput.value.trim().toLowerCase();
    const password = passwordInput.value.trim();

    if (!email || !password) {
      errorMsg.textContent = "⚠️ Please fill in all fields.";
      errorMsg.style.color = "red";
      return;
    }

    // 🔹 Fetch user data from localStorage
    const userData = localStorage.getItem(email);
    if (!userData) {
      errorMsg.textContent = "❌ Email not registered. Please sign up first.";
      errorMsg.style.color = "red";
      return;
    }

    const user = JSON.parse(userData);

    if (user.password !== password) {
      errorMsg.textContent = "❌ Incorrect password.";
      errorMsg.style.color = "red";
      return;
    }

    // ✅ Login successful
    errorMsg.textContent = "✅ Login successful!";
    errorMsg.style.color = "green";

    // Save current signed-in user
    localStorage.setItem("signedInUser", email);

    // Redirect to home page after short delay
    setTimeout(() => {
      window.location.href = "{% url 'index' %}";
    }, 2000);

  });

  // 🔹 Toggle password visibility
  togglePwd.addEventListener("click", () => {
    const type = passwordInput.type === "password" ? "text" : "password";
    passwordInput.type = type;
    togglePwd.style.color = type === "text" ? "#2f80ed" : "#666";
  });
});
</script>
{% endblock %}
